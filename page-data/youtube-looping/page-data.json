{"componentChunkName":"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx","path":"/youtube-looping","result":{"data":{"post":{"slug":"/youtube-looping","title":"Looping and slowing videos via YouTube's IFrame player API","date":"06.04.2018","tags":[{"name":"JavaScript","slug":"java-script"}],"description":null,"canonicalUrl":"https://oisinbates.com","body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Looping and slowing videos via YouTube's IFrame player API\",\n  \"date\": \"2018-04-06T00:00:00.000Z\",\n  \"tags\": [\"JavaScript\"],\n  \"slug\": \"/youtube-looping\",\n  \"canonicalUrl\": \"https://oisinbates.com\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h3\", null, \"Introduction\"), mdx(\"p\", null, \"A common method for musicians learning new music is to play along with recordings, isolating short sections and adjusting the tempo if necessary. I have recently been working on a hobby project to curate some of my favourite music by jazz saxophonist Charlie Parker (\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"charlieparkerlicks.com\"\n  }, \"charlieparkerlicks.com\"), \"). One hurdle to overcome was the copyright associated with directly hosting his recordings. As a consequence, embeded Youtube IFrames proved a good solution. This blog post provides an overview of how I coded my solution and some of the hurdles I faced while doing so. While \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://codepen.io/oisinbates/full/RMYawb\"\n  }, \"I have a running example hosted as a codepen.\"), \" and \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.google.com/youtube/iframe_api_reference\"\n  }, \"Youtube's documentation for their API\"), \" is quite good, this post will provide an abridged overview of the overall codebase.\"), mdx(\"h3\", null, \"Creating the Player\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, \"  function onYouTubeIframeAPIReady() {\\n    player = new YT.Player('player', {\\n      height: '270',\\n      width: '480',\\n      videoId: '-JKDFD1PZ8Y',\\n      playerVars: {'controls': 0, 'showinfo': 0, 'modestbranding': 0 },\\n      events: {\\n        'onReady': onPlayerReady,\\n        'onStateChange': onPlayerStateChange\\n      }\\n    });\\n  }\\n\")), mdx(\"p\", null, \"In creating the player, I chose to specify two events on which I wanted to call functions. The \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"onReady\"), \" event is fired whe the youtube API is ready to begin receiving calls. The \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"onStateChange\"), \" event is fired when the player changes states. In this case the most common states are \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"playing\"), \", \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"paused\"), \" and \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"buffering\"), \".\"), mdx(\"p\", null, \"As my use case is looping the audio of a specific tune, I decided to limit the scope of the player's user interface by passing a value of \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"0\"), \" for my chosen properties in the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"playerVars\"), \" object.\"), mdx(\"h3\", null, \"'onReady' : Get playback rates and create rate slider\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, \"  function onPlayerReady(event) {\\n      playbackRates = player.getAvailablePlaybackRates();\\n      $(\\\"#playback-rate-slider\\\").slider({\\n          min: 0,\\n          max: playbackRates.length - 1,\\n          value: [playbackRates.indexOf(1)],\\n          slide: function(event, ui) {                        \\n            $('#current-playback-rate').text(\\\"Playback Rate: \\\"+ playbackRates[ui.value])\\n          }       \\n      });\\n  }\\n\")), mdx(\"p\", null, \"In this case, the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"player\"), \" object is used to call the available playback rates before a slider is created, based on the number of available rates. This is necessary as the number of available playback rates will not always be the same. For example, if the user is on a mobile device, the API will currently only return a single playback rate (1 {Normal}).\"), mdx(\"p\", null, \"While it was sufficient to hard code the range slider for the loop's start and end times, in the case of loading many different videos an obvious benefit would be to access each video's duration via \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"player.getDuration()\"), \".\"), mdx(\"h3\", null, \"Managing loops with Timeouts\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, \"  var videoIsPlaying = false;\\n  var playbackRates;\\n  var timeoutIds = [];\\n\")), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout\"\n  }, \"Timeouts\"), \"\\nare essential as they fire the callback necessary to restart each loop.\"), mdx(\"p\", null, \"The biggest design issue surrounded access to click events on the IFrame.\\nWhen starting the video by clicking on the IFrame the user can set multiple timeouts,\\nwhile in contrast, it is easier to limit timeouts by restricting playback to\\nthe \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"start\"), \" button.\"), mdx(\"p\", null, \"If click events were disabled on the IFrame it would be easier to manage timeout\\nevents as it would only be possible to set a single timeout when clicking the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"start\"), \"\\nbutton. In contrast, when clicking the IFrame, the user can set multiple timeouts.\"), mdx(\"p\", null, \"When each callback is fired, the loop restarts, playing the video with the user's desired start and end point and playback speed. The \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"playbackRates\"), \" variable is used to determine how long the timeout will be, dividing the timeout length by the playback Rate (eg. if playback rate is 2, divide timeout length by 2).\"), mdx(\"p\", null, \"Finally, the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"videoIsPlaying\"), \" boolean is referenced so as to determine whether to start a new timeout and reset a loop, or not.\"), mdx(\"h3\", null, \"Start / Restart / Stop Looping\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, \"  function startVideo() {\\n    videoIsPlaying = false;\\n    player.pauseVideo();\\n\\n    clearTimeout(timeoutIds[0]);\\n    timeoutIds.shift();\\n\\n    let start = $( \\\"#youtube-range-slider\\\" ).slider( \\\"values\\\", 0 );\\n    let playbackRate = playbackRates[$( \\\"#playback-rate-slider\\\" ).slider( \\\"value\\\" )];\\n    player.setPlaybackRate(playbackRate);\\n    player.seekTo(start);\\n    videoIsPlaying = true;\\n    player.playVideo();\\n  }\\n\")), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"startVideo()\"), \" is called when the user starts the video, either by clicking the start button or clicking on the IFrame.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, \"  function restartVideoSection() {\\n      timeoutIds.shift();\\n      let start = $( \\\"#youtube-range-slider\\\" ).slider( \\\"values\\\", 0 );\\n      player.seekTo(start);\\n  }\\n\")), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"restartVideoSection()\"), \" is called when the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"onStateChange\"), \" event is triggered,\\nthe \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"videoIsPlaying\"), \" boolean is true, and there is only one timeout set.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, \"  function stopVideo() {\\n    videoIsPlaying = false;\\n    player.pauseVideo();\\n    clearTimeout(timeoutIds[0])\\n    timeoutIds.shift();\\n  }\\n\")), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"stopVideo()\"), \" stops playback and clears the most recent timeout.\"), mdx(\"h3\", null, \"'onStateChange' : starting/restarting playback and clearing timeouts\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, \"  function onPlayerStateChange(event) {\\n    if (event.data == YT.PlayerState.PLAYING) {\\n      if(!videoIsPlaying || timeoutIds.length > 0){\\n        if(timeoutIds.length > 0){\\n          player.pauseVideo();\\n          //if iframe clicks > 1, multiple timeouts are set\\n          //clear all timeouts then restart loop\\n          timeoutIds.map(timeoutID => clearTimeout(timeoutID));  \\n          timeoutIds=[];\\n          startVideo();\\n        }\\n        else{\\n          startVideo();\\n        }\\n      }\\n      else{\\n        //get current playback parameters and restart loop\\n        let start = $( \\\"#youtube-range-slider\\\" ).slider( \\\"values\\\", 0 );\\n        let end = $( \\\"#youtube-range-slider\\\" ).slider( \\\"values\\\", 1 );\\n        let playbackRate = playbackRates[$( \\\"#playback-rate-slider\\\" ).slider( \\\"value\\\" )];\\n        let duration = ((end - start) / playbackRate) * 1000;\\n\\n        player.setPlaybackRate(playbackRate);\\n        timeoutIds.push(window.setTimeout(restartVideoSection, duration));\\n      }\\n    }\\n  }\\n\")), mdx(\"p\", null, \"This function is called each time the player's state changes.\"), mdx(\"p\", null, \"If the player's state is \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"playing\"), \", either:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Clear timeouts if multiple timeouts are set, and then start videos\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Else if video is in playing state but the boolean isn't, start video\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Else if loop has completed and is restarting without issue, get current paramenters\\nand restart video\")), mdx(\"p\", null, \"A working demo is hosted \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://codepen.io/oisinbates/full/RMYawb\"\n  }, \"here\"), \" and source code is \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/oisinBates/youtube_looping_and_slowing\"\n  }, \"viewable on GitHub\"), \".\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"Introduction A common method for musicians learning new music is to play along with recordings, isolating short sections and adjusting theâ€¦","timeToRead":2,"banner":null}},"pageContext":{"slug":"/youtube-looping","formatString":"DD.MM.YYYY"}},"staticQueryHashes":["2744905544","3090400250","318001574"]}